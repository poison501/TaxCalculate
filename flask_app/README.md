# 进口商品计税应用

## 概述

本应用旨在为进口商品提供自动化计税服务。用户可以通过上传包含商品信息的CSV文件，快速计算相关税费。

## 主要功能

- **上传CSV文件**: 用户可以上传包含商品信息的CSV文件，系统将根据文件内容进行计税。
- **HS编码管理**: 系统内置HS编码与商品类型的映射关系，并支持对HS编码进行添加和管理（当前版本通过直接修改代码实现）。
- **计税逻辑**:
    - 根据商品的申报单价和数量计算完税价格。
    - 依据HS编码对应的关税税率计算关税。
    - 税额在50元人民币以下的免征关税。
- **输出结果**:
    - 提供计税结果的汇总统计信息。
    - 生成包含计税详情的CSV文件供用户下载和记录。

## 输入CSV文件结构

上传的CSV文件需要包含以下列（请确保列名与之一致）：

- `商品编码` (HS Code)
- `申报单价` (Declared Price per Unit)
- `数量` (Quantity)
- `分单号` (Sub-order Number)
- `物品名称` (Item Name)

## `hscode_mapping` 说明

`Taxable.py` 文件中包含一个名为 `hscode_mapping` 的Python字典，用于存储HS编码与商品详细信息的映射。该映射关系是计税逻辑的核心。

`hscode_mapping` 中每个HS编码对应一个字典，包含以下字段：

- `商品类型` (Product Category): 商品的中文描述。
- `关税税率` (Tariff Rate): 商品的关税税率（小数表示，例如0.1代表10%）。
- `法定单位` (Legal Unit): 商品的法定计量单位。
- `完税价格` (Tax Base Price): 用于计算关税的商品价格。在当前应用中，此字段通常在计税过程中根据申报单价和数量动态计算，但映射中可以包含一个默认或参考的完税价格。

**示例:**

```python
hscode_mapping = {
    "0101010101": {
        "商品类型": "示例商品A",
        "关税税率": 0.10,
        "法定单位": "千克",
        "完税价格": 100.0  # 此处可能为参考值
    },
    "0202020202": {
        "商品类型": "示例商品B",
        "关税税率": 0.20,
        "法定单位": "件",
        "完税价格": 50.0   # 此处可能为参考值
    }
    # ...更多HS编码
}
```

在计税时，系统会使用CSV文件中提供的`商品编码`在`hscode_mapping`中查找对应的`关税税率`，并结合`申报单价`和`数量`来计算实际的完税价格和应缴关税。

## 如何运行应用

1.  确保已安装 Python 和 Flask。如果未安装Flask，可以通过pip安装：
    ```bash
    pip install Flask
    ```
2.  在项目根目录下，导航到 `flask_app` 目录：
    ```bash
    cd flask_app
    ```
3.  运行应用：
    ```bash
    python app.py
    ```
4.  在浏览器中打开 `http://127.0.0.1:5000/` 即可访问应用。

## 关键文件说明

-   **`app.py`**: Flask应用的主文件，包含路由定义、请求处理逻辑（如文件上传、计税调用）以及与前端页面的交互。
-   **`Taxable.py`**: 包含核心计税逻辑的模块，定义了`TaxableGood`类以及`hscode_mapping`。
-   **`templates/`**: 该目录存放HTML模板文件，用于渲染前端页面。
    -   `index.html`: 应用的主页面，包含文件上传表单和结果展示区域。
    -   `results.html`: （如果存在）可能用于展示更详细的计税结果或单独的结果页面。

## 语言

本应用程序的用户界面和代码注释主要使用中文。
